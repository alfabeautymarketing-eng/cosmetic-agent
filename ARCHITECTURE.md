# ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Cosmetic Agent

## ğŸ“ ĞĞ±Ñ‰Ğ°Ñ ÑÑ…ĞµĞ¼Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Telegram Bot   â”‚
â”‚  (Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      n8n        â”‚
â”‚   (Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ HTTP POST /webhook
         â”‚ JSON payload
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Cosmetic Agent (Backend)         â”‚
â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    Express Server (Node.js)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                â”‚                      â”‚
â”‚                â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     Webhook Handler             â”‚ â”‚
â”‚  â”‚  (Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ, Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ)      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                â”‚                      â”‚
â”‚                â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     Card Processor              â”‚ â”‚
â”‚  â”‚  (Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°)       â”‚ â”‚
â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚      â”‚               â”‚                â”‚
â”‚      â–¼               â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Drive  â”‚    â”‚ Sheets   â”‚          â”‚
â”‚  â”‚Service â”‚    â”‚ Service  â”‚          â”‚
â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚
       â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Google      â”‚ â”‚ Google       â”‚
â”‚ Drive API   â”‚ â”‚ Sheets API   â”‚
â”‚             â”‚ â”‚              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ĞŸĞ°Ğ¿ĞºĞ¸ Ñ  â”‚ â”‚ â”‚ â”‚ Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°  â”‚ â”‚
â”‚ â”‚Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼Ğ¸  â”‚ â”‚ â”‚ â”‚ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞµĞº â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### 1. ĞŸÑ€Ğ¸ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```javascript
POST /webhook
{
  chatId: "123456789",
  productName: "ĞšÑ€ĞµĞ¼ ÑƒĞ²Ğ»Ğ°Ğ¶Ğ½ÑÑÑ‰Ğ¸Ğ¹",
  purpose: "Ğ£Ğ²Ğ»Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ¶Ğ¸",
  application: "ĞĞ°Ğ½Ğ¾ÑĞ¸Ñ‚ÑŒ ÑƒÑ‚Ñ€Ğ¾Ğ¼ Ğ¸ Ğ²ĞµÑ‡ĞµÑ€Ğ¾Ğ¼",
  inci: "Aqua, Glycerin, ...",
  inciDocUrl: "https://example.com/doc.pdf",
  photoUrls: ["https://example.com/photo.jpg"]
}
```

### 2. ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°

```
webhookRouter
    â†“
cardProcessor.processCard()
    â†“
â”œâ”€ generateCardId() â†’ "CARD-1234567890-123"
â”‚
â”œâ”€ driveService.createFolder()
â”‚   â†’ Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ Ğ¿Ğ°Ğ¿ĞºÑƒ "[CARD-...] ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ"
â”‚
â”œâ”€ fileDownloader.download()
â”‚   â†’ Ğ¡ĞºĞ°Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ INCI.pdf Ğ¸ Ñ„Ğ¾Ñ‚Ğ¾
â”‚
â”œâ”€ driveService.uploadFile()
â”‚   â†’ Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ² Ğ¿Ğ°Ğ¿ĞºÑƒ
â”‚
â””â”€ sheetsService.addCardRow()
    â†’ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑÑ‚Ñ€Ğ¾ĞºÑƒ Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ
```

### 3. ĞÑ‚Ğ²ĞµÑ‚

```javascript
{
  success: true,
  cardId: "CARD-1234567890-123",
  driveFolder: {
    id: "folder_id",
    url: "https://drive.google.com/...",
    uploadedFiles: [...]
  },
  sheetRow: 2
}
```

## ğŸ›ï¸ Ğ¡Ğ»Ğ¾Ğ¸ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ

### Layer 1: HTTP Server (Express)

**Ğ¤Ğ°Ğ¹Ğ»:** `src/server.js`

ĞÑ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚ Ğ·Ğ°:
- Ğ—Ğ°Ğ¿ÑƒÑĞº HTTP ÑĞµÑ€Ğ²ĞµÑ€Ğ°
- Middleware (Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ JSON, Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)
- ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
- ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº

### Layer 2: Routes (ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚Ñ‹)

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹:**
- `src/routes/health.js` - health check
- `src/routes/webhook.js` - Ğ¿Ñ€Ğ¸ĞµĞ¼ webhook Ğ¾Ñ‚ n8n

ĞÑ‚Ğ²ĞµÑ‡Ğ°ÑÑ‚ Ğ·Ğ°:
- Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ²Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ (webhook secret)
- Ğ’Ñ‹Ğ·Ğ¾Ğ² Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸
- Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ HTTP Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ²

### Layer 3: Services (Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°)

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹:**
- `src/services/cardProcessor.js` - Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞµĞº
- `src/services/driveService.js` - Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ Google Drive
- `src/services/sheetsService.js` - Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ Google Sheets

ĞÑ‚Ğ²ĞµÑ‡Ğ°ÑÑ‚ Ğ·Ğ°:
- ĞÑĞ½Ğ¾Ğ²Ğ½ÑƒÑ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
- ĞÑ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹
- Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°

### Layer 4: Utilities (Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹)

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹:**
- `src/utils/fileDownloader.js` - ÑĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
- `src/config/googleAuth.js` - Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Google

ĞÑ‚Ğ²ĞµÑ‡Ğ°ÑÑ‚ Ğ·Ğ°:
- Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸
- ĞŸĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ñ‹Ğ¹ ĞºĞ¾Ğ´
- ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

### Layer 5: External APIs (Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹)

- Google Drive API
- Google Sheets API
- HTTP endpoints (Ğ´Ğ»Ñ ÑĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²)

## ğŸ” Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

### ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ

```
n8n â†’ [x-webhook-secret header] â†’ Agent

Agent Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚:
if (req.headers['x-webhook-secret'] !== process.env.WEBHOOK_SECRET) {
  return 401 Unauthorized
}
```

### Google API ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

```
Service Account (credentials.json)
    â†“
Google Auth Client
    â†“
Access Token (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ)
    â†“
API requests Ñ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ¼
```

### Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

- `.env` Ñ„Ğ°Ğ¹Ğ» Ğ² `.gitignore` (Ğ½Ğµ Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ Ğ² Git)
- `credentials.json` Ğ² `.gitignore`
- ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ğ² Render (Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹)
- HTTPS Ğ½Ğ° Render (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸)

## ğŸ—„ï¸ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Google Drive

```
ğŸ“‚ Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ Ğ¿Ğ°Ğ¿ĞºĞ° (ID: 1rELo6cM69I8_105PY-XKuJv1W33VDH1R)
â”‚
â”œâ”€â”€ ğŸ“ [CARD-1234567890-123] ĞšÑ€ĞµĞ¼ ÑƒĞ²Ğ»Ğ°Ğ¶Ğ½ÑÑÑ‰Ğ¸Ğ¹
â”‚   â”œâ”€â”€ ğŸ“„ INCI.pdf
â”‚   â”œâ”€â”€ ğŸ–¼ photo_1.jpg
â”‚   â””â”€â”€ ğŸ–¼ photo_2.jpg
â”‚
â”œâ”€â”€ ğŸ“ [CARD-1234567890-456] Ğ¡Ñ‹Ğ²Ğ¾Ñ€Ğ¾Ñ‚ĞºĞ° Ğ°Ğ½Ñ‚Ğ¸Ğ²Ğ¾Ğ·Ñ€Ğ°ÑÑ‚Ğ½Ğ°Ñ
â”‚   â”œâ”€â”€ ğŸ“„ INCI.pdf
â”‚   â””â”€â”€ ğŸ–¼ photo_1.jpg
â”‚
â””â”€â”€ ...
```

## ğŸ“Š Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Google Sheets

```
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€...
â”‚ ID â”‚ ID-ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸         â”‚ ID-Ğ§Ğ°Ñ‚    â”‚ ĞĞ°Ğ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ  â”‚ ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ  â”‚ ...
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€...
â”‚  1 â”‚ CARD-1234567890-123 â”‚ 987654321 â”‚ ĞšÑ€ĞµĞ¼ ÑƒĞ²Ğ»Ğ°Ğ¶... â”‚ Ğ£Ğ²Ğ»Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ  â”‚ ...
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€...
â”‚  2 â”‚ CARD-1234567890-456 â”‚ 987654321 â”‚ Ğ¡Ñ‹Ğ²Ğ¾Ñ€Ğ¾Ñ‚ĞºĞ° ... â”‚ ĞĞ½Ñ‚Ğ¸Ğ²Ğ¾Ğ·Ñ€... â”‚ ...
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€...
```

## ğŸ”® Ğ‘ÑƒĞ´ÑƒÑ‰Ğ¸Ğµ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ñ

### AI Processing Layer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Cosmetic Agent                   â”‚
â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     Card Processor              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â”‚                        â”‚
â”‚              â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     AI Service (Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ)        â”‚ â”‚
â”‚  â”‚  - extractActiveIngredients()   â”‚ â”‚
â”‚  â”‚  - generateBookletComposition() â”‚ â”‚
â”‚  â”‚  - translateIngredients()       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚             â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Claude API /      â”‚
     â”‚  OpenAI API /      â”‚
     â”‚  Gemini API        â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Workflow Ñ AI

```
1. ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°
2. INCI Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹
3. AI Service Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ INCI:
   â”œâ”€ Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¸Ğ½Ğ³Ñ€ĞµĞ´Ğ¸ĞµĞ½Ñ‚Ñ‹
   â”œâ”€ Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ ÑĞ¾ÑÑ‚Ğ°Ğ² Ğ´Ğ»Ñ Ğ±ÑƒĞºĞ»ĞµÑ‚Ğ°
   â””â”€ ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¸Ñ‚ Ğ½Ğ° Ğ°Ğ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¸Ğ¹
4. Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ÑÑ‚ÑÑ Ğ² Sheets (ÑÑ‚Ğ¾Ğ»Ğ±Ñ†Ñ‹ I-N)
```

## ğŸ“ˆ ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### Ğ“Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

ĞĞ° Render/Railway Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ´Ğ½ÑÑ‚ÑŒ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¸Ğ½ÑÑ‚Ğ°Ğ½ÑĞ¾Ğ²:

```
Load Balancer
    â”œâ”€ Agent Instance 1
    â”œâ”€ Agent Instance 2
    â””â”€ Agent Instance 3
```

Ğ’ÑĞµ Ğ¸Ğ½ÑÑ‚Ğ°Ğ½ÑÑ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚ Ñ Ğ¾Ğ´Ğ½Ğ¸Ğ¼:
- Google Drive (stateless)
- Google Sheets (stateless)

### Ğ’ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ñ‰Ğ½Ğ¾ÑÑ‚Ğ¸ ÑĞµÑ€Ğ²ĞµÑ€Ğ°:
- Free: 512MB RAM
- Starter: 1GB RAM ($7/Ğ¼ĞµÑÑÑ†)
- Standard: 2GB RAM ($25/Ğ¼ĞµÑÑÑ†)

### ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

**Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ:**
- ~100 ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞµĞº/Ñ‡Ğ°Ñ (Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)
- ~1000 ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞµĞº/Ğ´ĞµĞ½ÑŒ

**Ğ£Ğ·ĞºĞ¸Ğµ Ğ¼ĞµÑÑ‚Ğ°:**
- Ğ¡ĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² (Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚Ğ¸ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ°)
- Google API rate limits (1000 requests/100 seconds)

**ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:**
- ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
- ĞšĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Google Auth Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²
- Batch Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Sheets

## ğŸ§ª Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### Ğ£Ñ€Ğ¾Ğ²Ğ½Ğ¸ Ñ‚ĞµÑÑ‚Ğ¾Ğ²

```
E2E Tests
    â†“
Integration Tests
    â†“
Unit Tests
```

### Unit Tests (Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ)

```javascript
// tests/services/cardProcessor.test.js
describe('CardProcessor', () => {
  it('should generate unique card ID', () => {
    const id1 = cardProcessor.generateCardId();
    const id2 = cardProcessor.generateCardId();
    expect(id1).not.toBe(id2);
  });
});
```

### Integration Tests (Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ)

```javascript
// tests/integration/webhook.test.js
describe('POST /webhook', () => {
  it('should create card and return success', async () => {
    const response = await request(app)
      .post('/webhook')
      .send(testCardData);

    expect(response.status).toBe(200);
    expect(response.body.success).toBe(true);
  });
});
```

## ğŸ” ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³

### Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

Ğ’ÑĞµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒÑÑ‚ÑÑ Ñ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¼ĞµÑ‚ĞºĞ°Ğ¼Ğ¸:

```
[2024-01-18T12:00:00.000Z] POST /webhook
ğŸ“¨ ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½ webhook Ğ¾Ñ‚ n8n
ğŸ”„ ĞĞ°Ñ‡Ğ¸Ğ½Ğ°ĞµĞ¼ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸ CARD-123
ğŸ“ ĞŸĞ°Ğ¿ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°
âœ… ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾
```

### ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ (Render Dashboard)

- Request count
- Response time
- Error rate
- CPU usage
- Memory usage

### ĞĞ»ĞµÑ€Ñ‚Ñ‹ (Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ)

- Error rate > 10% â†’ Email alert
- Response time > 5s â†’ Slack notification
- Memory usage > 90% â†’ Auto-scale

## ğŸŒ Deployment

### Development

```
Local Machine
    â†“
npm run dev (nodemon)
    â†“
http://localhost:3000
```

### Production (Render)

```
GitHub Repository
    â†“ (auto deploy on push)
Render Build System
    â†“
npm install
    â†“
npm start
    â†“
https://cosmetic-agent.onrender.com
```

### CI/CD (Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞµ)

```
GitHub Actions
    â”œâ”€ Run tests
    â”œâ”€ Run linter
    â””â”€ Deploy to Render (if tests pass)
```

## ğŸ“š Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹

- [Google Drive API Docs](https://developers.google.com/drive/api/v3/about-sdk)
- [Google Sheets API Docs](https://developers.google.com/sheets/api/guides/concepts)
- [Express.js Best Practices](https://expressjs.com/en/advanced/best-practice-performance.html)
- [Node.js Security Checklist](https://cheatsheetseries.owasp.org/cheatsheets/Nodejs_Security_Cheat_Sheet.html)
